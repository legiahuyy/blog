I"÷’<p>BÃ i viáº¿t nÃ y Ä‘Æ°á»£c mÃ¬nh dá»‹ch tá»« blog cá»§a team <a href="https://googleprojectzero.blogspot.com/2020/01/remote-iphone-exploitation-part-1.html">Google Project Zero</a>.</p>

<p><img src="https://miro.medium.com/max/700/0*OQM7yi64GbLtBjNb.jpg" alt="Image for post" style="zoom:67%;" /></p>

<p><strong>LÆ°u Ã½:</strong> BÃ i viáº¿t gá»‘c cá»§a tÃ¡c giáº£ cÃ³ ráº¥t nhiá»u nhá»¯ng tá»« chuyÃªn ngÃ nh dá»‹ch sang tiáº¿ng Viá»‡t nghe ráº¥t â€¦oáº£i vÃ  khÃ´ng trá»n váº¹n nghÄ©a nÃªn mÃ¬nh sáº½ Ä‘á»ƒ nguyÃªn. NgoÃ i ra mÃ¬nh cÅ©ng cÃ³ thÃªm má»™t sá»‘ giáº£i thÃ­ch Ä‘á»ƒ giÃºp báº¡n Ä‘á»c hiá»ƒu rÃµ hÆ¡n vá» research cá»§a tÃ¡c giáº£ cÅ©ng nhÆ° cÃ¡c tá»« chuyÃªn mÃ´n trong bÃ i. Enjoy!</p>

<h1 id="lá»i-má»Ÿ-Ä‘áº§u">Lá»i má»Ÿ Ä‘áº§u</h1>

<p>ÄÃ¢y lÃ  blog post Ä‘áº§u trong series <em>Remote iPhone Exploitation.</em> Trong series nÃ y, chÃºng ta sáº½ Ä‘i chi tiáº¿t vá» lá»— há»•ng trÃªn iMessage cÃ³ thá»ƒ bá»‹ khai thÃ¡c tá»« xa mÃ  khÃ´ng cáº§n user pháº£i â€œÄ‘á»¥ng chÃ¢n Ä‘á»¥ng tayâ€. Lá»— há»•ng nÃ y tá»“n táº¡i á»Ÿ phiÃªn báº£n iOS 12.4 (hiá»‡n Ä‘Ã£ Ä‘Æ°á»£c vÃ¡ trong iOS 12.4.1 há»“i thÃ¡ng 8/2019). Báº¡n Ä‘á»c cÃ³ thá»ƒ tÃ¬m hiá»ƒu thÃªm <a href="https://media.ccc.de/v/36c3-10497-messenger_hacking_remotely_compromising_an_iphone_through_imessage"><em>táº¡i Ä‘Ã¢y</em></a><em>.</em></p>

<p>Pháº§n má»™t sáº½ cung cáº¥p cho chÃºng ta thÃ´ng tin vá» lá»— há»•ng, pháº§n tiáº¿p theo sáº½ nÃ³i vá» ká»¹ thuáº­t bypass ASLR (<strong>A</strong>ddress <strong>S</strong>pace <strong>L</strong>ayout <strong>R</strong>andomization) vÃ  pháº§n cuá»‘i cÃ¹ng sáº½ giáº£i thÃ­ch cÃ¡ch thá»±c hiá»‡n RCE (<strong>R</strong>emote <strong>C</strong>ode <strong>E</strong>xecution â€” thá»±c thi mÃ£ lá»‡nh tá»« xa).</p>

<p>Vá»›i viá»‡c khai thÃ¡c lá»— há»•ng trÃªn, ngÆ°á»i táº¥n cÃ´ng chá»‰ cáº§n cÃ³ Ä‘Æ°á»£c Apple ID (sá»‘ Ä‘iá»‡n thoáº¡i hoáº·c email) thÃ¬ sáº½ kiá»ƒm soÃ¡t Ä‘Æ°á»£c hoÃ n toÃ n thiáº¿t bá»‹ iOS cá»§a náº¡n nhÃ¢n. Káº¿ tiáº¿p, káº» xáº¥u cÃ³ thá»ƒ can thiá»‡p vÃ o toÃ n bá»™ file, máº­t kháº©u, mÃ£ xÃ¡c minh, tin nháº¯n (SMS/etc), email vÃ  nhá»¯ng thÃ´ng tin khÃ¡c. ChÃºng cÅ©ng cÃ³ thá»ƒ báº­t/táº¯t microphone vÃ  camera cá»§a thiáº¿t bá»‹ mÃ  ngÆ°á»i dÃ¹ng khÃ´ng há» hay biáº¿t vÃ¬ khÃ´ng cÃ³ báº¥t cá»© thÃ´ng bÃ¡o nÃ o xuáº¥t hiá»‡n cáº£. Chá»‰ báº±ng cÃ¡ch khai thÃ¡c má»™t lá»— há»•ng duy nháº¥t â€” <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-8641">CVE-2019â€“8641</a>, ta cÃ³ thá»ƒ bypass ASLR rá»“i thá»±c thi mÃ£ ngáº§m bÃªn ngoÃ i <a href="https://genk.vn/may-tinh/tim-hieu-ve-sandbox-hop-cat-bao-ve-an-toan-cho-may-tinh-cua-ban-20131029225422614.chn">sandbox</a> trÃªn thiáº¿t bá»‹.</p>

<p>BÃ i viáº¿t nÃ y, Ä‘á»“ng thá»i cÅ©ng lÃ  Ä‘á»ƒ giáº£i Ä‘Ã¡p cho cÃ¢u há»i:</p>

<blockquote>
  <p>Chá»‰ vá»›i má»™t lá»— há»•ng vá» bá»™ nhá»›, liá»‡u ta cÃ³ Ä‘Æ°á»£c RCE trÃªn thiáº¿t bá»‹ iOS mÃ  khÃ´ng cáº§n khai thÃ¡c thÃªm báº¥t kÃ¬ lá»— há»•ng nÃ o hay khÃ´ng?</p>
</blockquote>

<p>CÃ¢u tráº£ lá»i lÃ  cÃ³, vÃ  giá» ta sáº½ chá»©ng minh.</p>

<h2 id="cve-20198641">CVE-2019â€“8641</h2>

<p>Lá»— há»•ng Ä‘Æ°á»£c tÃ¬m tháº¥y trong má»™t dá»± Ã¡n tÃ¬m lá»— há»•ng chung vá»›i Natalie Silvanovich vÃ  Ä‘Ã£ <a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=1917">bÃ¡o cÃ¡o cho Apple vÃ o 29/7/2019</a>, tiáº¿p Ä‘Ã³ lÃ  PoC (Proof-of-Concept â€” nÃ³i Ä‘Æ¡n giáº£n lÃ  chá»©ng minh tÃ­nh kháº£ thi cá»§a viá»‡c khai thÃ¡c) Ä‘Æ°á»£c gá»­i Ä‘i vÃ o 9/8/2019. Lá»— há»•ng Ä‘Æ°á»£c Apple â€œvÃ¡ táº¡mâ€ báº±ng cÃ¡ch <a href="https://twitter.com/5aelo/status/1172534071332917248">cháº·n truy cáº­p Ä‘áº¿n Ä‘oáº¡n code cÃ³ lá»— há»•ng</a>, sau Ä‘Ã³ Ä‘Æ°á»£c sá»­a hoÃ n toÃ n trÃªn iOS 13.2.</p>

<p>DÃ nh cho nhá»¯ng ai muá»‘n nghiÃªn cá»©u, Ä‘Ã¢y lÃ  <a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=1917#c6">PoC trÃªn iOS 12.4</a> cá»§a iPhone XS.</p>

<h1 id="mÃ´-hÃ¬nh-hoáº¡t-Ä‘á»™ng-cá»§a-imessage">MÃ´ hÃ¬nh hoáº¡t Ä‘á»™ng cá»§a iMessage</h1>

<p>Nhá»¯ng tin nháº¯n iMessage trÆ°á»›c khi dáº¿n Ä‘Æ°á»£c vá»›i ngÆ°á»i dÃ¹ng thÃ¬ nÃ³ pháº£i Ä‘i qua nhiá»u nhá»¯ng service (dá»‹ch vá»¥) vÃ  framework. Main service xá»­ lÃ½ nhá»¯ng tin nháº¯n iMessage trÃªn iOS 12.4 mÃ  khÃ´ng cáº§n sá»± tÆ°Æ¡ng tÃ¡c cá»§a ngÆ°á»i dÃ¹ng Ä‘Æ°á»£c biá»ƒu diá»…n nhÆ° sau:</p>

<p><img src="https://miro.medium.com/max/800/0*_frn4sUkDCN8rQes.png" alt="CÃ¡c Ã´ Ä‘Æ°á»£c khoanh Ä‘á» lÃ  nhá»¯ng tiáº¿n trÃ¬nh cháº¡y trong sandbox cá»§a iOS" style="zoom:80%;" /></p>

<p>Nhá»¯ng Ä‘á»‘i tÆ°á»£ng bÃªn ngoÃ i sandbox mÃ  ta cÃ³ thá»ƒ khai thÃ¡c bao gá»“m <a href="https://developer.apple.com/documentation/foundation/nskeyedunarchiver?language=objc">NSKeyedUnarchiver API</a> vÃ  data format cá»§a iMessage. Sau khi tÃ¬m hiá»ƒu, lá»— há»•ng trong NSKeyedUnarchiver API cÃ³ thá»ƒ Ä‘Æ°á»£c â€œkÃ­ch hoáº¡tâ€ báº±ng hai cÃ¡ch:</p>

<ul>
  <li>Trong tiáº¿n trÃ¬nh <strong>imagent</strong>.</li>
  <li>NgoÃ i sandbox, trong pháº§n <strong>SpringBoard</strong> (tiáº¿n trÃ¬nh quáº£n lÃ­ giao diá»‡n iOS, bao gá»“m mÃ n hÃ¬nh khÃ³a).</li>
</ul>

<p>Cáº£ hai cÃ¡ch nÃ y Ä‘á»u cÃ³ Ä‘iá»ƒm cÃ³ lá»£i vÃ  báº¥t lá»£i cho viá»‡c khai thÃ¡c. VÃ­ dá»¥, trong khi SpringBoard cÃ³ thá»ƒ cháº¡y bÃªn ngoÃ i sandbox nhÆ°ng nÃ³ cÅ©ng sáº½ hiá»‡n thÃ´ng bÃ¡o â€œrespringâ€ trÃªn thiáº¿t bá»‹ viá»‡c ta can thiá»‡p lÃ m há»‡ thá»‘ng bá»‹ crash (ai vá»c jaibreak nhiá»u sáº½ biáº¿t). Imagent thÃ¬ khÃ´ng nhÆ° tháº¿ nhÆ°ng nÃ³ láº¡i náº±m trong sandbox â€” má»i thay Ä‘á»•i sáº½ bá»‹ xÃ³a khi ngÆ°á»i dÃ¹ng restart.</p>

<p>Trong báº£n vÃ¡ iOS 13, viá»‡c decode data cá»§a NSKeyedUnarchiver khÃ´ng cÃ²n xáº£y ra trÃªn SpringBoard ná»¯a mÃ  lÃ  trong sandbox IMDPersistenceAgent.</p>

<h2 id="exploit-imessage">Exploit iMessage</h2>

<p>Äá»ƒ cÃ³ thá»ƒ gá»­i exploit qua iMessage, ta pháº£i cÃ³ kháº£ nÄƒng gá»­i tin nháº¯n tÃ¹y chá»‰nh (custom message) Ä‘áº¿n má»¥c tiÃªu. Äiá»u nÃ y Ä‘Ã²i há»i viá»‡c pháº£i tÆ°Æ¡ng tÃ¡c vá»›i server cá»§a Apple vÃ  xá»­ lÃ½ E2E (end-to-end) encryption cá»§a iMessage. Tuy nhiÃªn, cÃ³ má»™t cÃ¡ch Ä‘Æ¡n giáº£n hÆ¡n Ä‘á»ƒ lÃ m Ä‘iá»u nÃ y Ä‘Ã³ lÃ  â€œtÃ¡i sá»­ dá»¥ngâ€ code xá»­ lÃ­ trong <strong>imagent</strong> cá»§a iMessage. CÃ´ng cá»¥ nhÆ° <a href="https://frida.re/">frida</a> cÃ³ thá»ƒ giÃºp ta gá»­i Ä‘oáº¡n tin nháº¯n custom Ä‘Ã³ trÃªn MacOS nhÆ° sau:</p>

<ol>
  <li>Build má»™t payload (Ä‘á»ƒ â€œkÃ­ch hoáº¡tâ€ bug cá»§a NSKeyedUnarchiver) vÃ  lÆ°u nÃ³ vÃ o disk.</li>
  <li>Sá»­ dá»¥ng AppleScript Ä‘á»ƒ ra hiá»‡u cho <a href="http://messages.app/">Messages.app</a> (má»™t dá»‹ch vá»¥ giáº£ láº­p iMessage mÃ  hÃ¬nh nhÆ° Ä‘Ã£ bá»‹ gá»¡ xuá»‘ng) gá»­i má»™t tin nháº¯n báº¥t kÃ¬ (VD: â€œREPLACEMEâ€) Ä‘áº¿n má»¥c tiÃªu.</li>
  <li>Hook <strong>imagent</strong> báº±ng frida vÃ  thay tháº¿ tin nháº¯n Ä‘Æ°á»£c gá»­i Ä‘i báº±ng payload vá»«a táº¡o.</li>
</ol>

<p>CÅ©ng báº±ng cÃ¡ch nÃ y ta cÃ³ thá»ƒ nháº­n tin nháº¯n báº±ng cÃ¡ch sá»­ dá»¥ng frida Ä‘á»ƒ hook hÃ m <em>receiver</em> trong <strong>imagent</strong>.</p>

<p>Äoáº¡n mÃ£ dÆ°á»›i Ä‘Ã¢y lÃ  vÃ­ dá»¥, dÃ²ng tin nháº¯n iMessage (encode <a href="https://en.wikipedia.org/wiki/Property_list#macOS">binary plist</a>) sáº½ Ä‘Æ°á»£c gá»­i Ä‘áº¿n ngÆ°á»i nháº­n vá»›i ná»™i dung â€œREPLACEMEâ€:</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td> --><td class="rouge-code"><pre><span class="p">{</span>
    <span class="n">gid</span> <span class="o">=</span> <span class="s">"008412B9-A4F7-4B96-96C3-70C4276CB2BE"</span><span class="p">;</span>
    <span class="n">gv</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
    <span class="n">p</span> <span class="o">=</span>     <span class="p">(</span>
        <span class="s">"mailto:sender@foo.bar"</span><span class="p">,</span>
        <span class="s">"mailto:receiver@foo.bar"</span>
    <span class="p">);</span>
    <span class="n">pv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="s">"6401430E-CDD3-4BC7-A377-7611706B431F"</span><span class="p">;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="s">"REPLACEME"</span><span class="p">;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s">"&lt;html&gt;&lt;body&gt;REPLACEME&lt;/body&gt;&lt;/html&gt;"</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>CÃ´ng cá»¥ Frida sáº½ chá»‰nh sá»­a láº¡i tin nháº¯n trÆ°á»›c khi nÃ³ Ä‘Æ°á»£c Ä‘Ã¡nh sá»‘, mÃ£ hÃ³a vÃ  gá»­i Ä‘áº¿n server cá»§a Apple:</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td> --><td class="rouge-code"><pre><span class="p">{</span>
    <span class="n">gid</span> <span class="o">=</span> <span class="s">"008412B9-A4F7-4B96-96C3-70C4276CB2BE"</span><span class="p">;</span>
    <span class="n">gv</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
    <span class="n">p</span> <span class="o">=</span>     <span class="p">(</span>
        <span class="s">"mailto:sender@foo.bar"</span><span class="p">,</span>
        <span class="s">"mailto:receiver@foo.barâ€</span><span class="err">
</span><span class="s">    );</span><span class="err">
</span><span class="s">    pv = 0;</span><span class="err">
</span><span class="s">    r = "</span><span class="mi">6401430</span><span class="n">E</span><span class="o">-</span><span class="n">CDD3</span><span class="o">-</span><span class="mi">4</span><span class="n">BC7</span><span class="o">-</span><span class="n">A377</span><span class="o">-</span><span class="mi">7611706</span><span class="n">B431F</span><span class="s">";</span><span class="err">
</span><span class="s">    t = "</span><span class="n">REPLACEME</span><span class="s">";</span><span class="err">
</span><span class="s">    v = 1;	</span><span class="err">
</span><span class="s">    x = "</span><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;&lt;</span><span class="n">body</span><span class="o">&gt;</span><span class="n">REPLACEME</span><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;&lt;/</span><span class="n">html</span><span class="o">&gt;</span><span class="s">";</span><span class="err">
</span><span class="s">    ati = &lt;content of /private/var/tmp/com.apple.messages/payload&gt;;</span><span class="err">
</span><span class="s">}</span><span class="err">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Sau khi gá»­i, Ä‘oáº¡n tin nháº¯n trÃªn sáº½ khiáº¿n cho tiáº¿n trÃ¬nh <strong>imagent</strong> cá»§a ngÆ°á»i nháº­n deocde dá»¯ liá»‡u trong <em>ati</em> báº±ng cÃ¡ch sá»­ dá»¥ng NSKeyedUnarchiver API.</p>

<p>Tiáº¿p theo, chÃºng ta sáº½ sá»­ dá»¥ng CVE-2019â€“8641 Ä‘á»ƒ tiáº¿n hÃ nh khai thÃ¡c. Äá»ƒ hiá»ƒu rÃµ hÆ¡n vá» bug nÃ y, ta cáº§n pháº£i xem format serial cá»§a NSKeyedUnarchiver. DÆ°á»›i Ä‘Ã¢y lÃ  má»™t archive Ä‘Æ¡n giáº£n chá»©a serial NSSharedKeyDictionary (NSKeyedUnarchiver Ä‘Ã£ encode Ä‘á»‘i tÆ°á»£ng trong graph thÃ nh <em>plist</em>):</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
</pre></td> --><td class="rouge-code"><pre><span class="p">{</span>
  <span class="dl">"</span><span class="s2">$archiver</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="dl">"</span><span class="s2">NSKeyedArchiver</span><span class="dl">"</span>
  <span class="err">#</span> <span class="nx">The</span> <span class="nx">objects</span> <span class="nx">contained</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">archive</span> <span class="nx">are</span> <span class="nx">stored</span> <span class="k">in</span> <span class="k">this</span> <span class="nx">array</span>
  <span class="err">#</span> <span class="nx">and</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">referenced</span> <span class="nx">during</span> <span class="nx">decoding</span> <span class="nx">using</span> <span class="nx">their</span> <span class="nx">index</span>
  <span class="dl">"</span><span class="s2">$objects</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="err">#</span> <span class="nx">Index</span> <span class="mi">0</span> <span class="nx">always</span> <span class="nx">contains</span> <span class="nx">the</span> <span class="nx">nil</span> <span class="nx">value</span>
    <span class="mi">0</span> <span class="o">=&gt;</span> <span class="dl">"</span><span class="s2">$null</span><span class="dl">"</span>
    <span class="err">#</span> <span class="nx">The</span> <span class="nx">serialized</span> <span class="nx">NSSharedKeyDictionary</span>
    <span class="mi">1</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">$class</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">CFKeyedArchiverUID</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">value</span> <span class="o">=</span> <span class="mi">7</span><span class="p">}</span>
      <span class="dl">"</span><span class="s2">NS.count</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="mi">0</span>
      <span class="dl">"</span><span class="s2">NS.sideDic</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">CFKeyedArchiverUID</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">}</span>
      <span class="dl">"</span><span class="s2">NS.skkeyset</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">CFKeyedArchiverUID</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">}</span>
    <span class="p">}</span>
    <span class="err">#</span> <span class="nx">The</span> <span class="nx">NSSharedKeySet</span> <span class="nx">associated</span> <span class="kd">with</span> <span class="nx">the</span> <span class="nx">dictionary</span>    
    <span class="mi">2</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">$class</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">CFKeyedArchiverUID</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">value</span> <span class="o">=</span> <span class="mi">6</span><span class="p">}</span>
      <span class="dl">"</span><span class="s2">NS.algorithmType</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="mi">1</span>
      <span class="dl">"</span><span class="s2">NS.factor</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="mi">3</span>
      <span class="dl">"</span><span class="s2">NS.g</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="mi">00</span><span class="o">&gt;</span>
      <span class="dl">"</span><span class="s2">NS.keys</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">CFKeyedArchiverUID</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">}</span>
      <span class="dl">"</span><span class="s2">NS.M</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="mi">6</span>
      <span class="dl">"</span><span class="s2">NS.numKey</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="mi">1</span>
      <span class="dl">"</span><span class="s2">NS.rankTable</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="mi">00000000</span> <span class="mi">0001</span><span class="o">&gt;</span>
      <span class="dl">"</span><span class="s2">NS.seed0</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="mi">361949685</span>
      <span class="dl">"</span><span class="s2">NS.seed1</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="mi">2328087422</span>
      <span class="dl">"</span><span class="s2">NS.select</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="mi">0</span>
      <span class="dl">"</span><span class="s2">NS.subskset</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">CFKeyedArchiverUID</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">}</span>
    <span class="p">}</span>
    <span class="err">#</span> <span class="nx">The</span> <span class="nx">keys</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">NSSharedKeySet</span> 
    <span class="mi">3</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">$class</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">CFKeyedArchiverUID</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">value</span> <span class="o">=</span> <span class="mi">5</span><span class="p">}</span>
      <span class="dl">"</span><span class="s2">NS.objects</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="mi">0</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">CFKeyedArchiverUID</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">value</span> <span class="o">=</span> <span class="mi">4</span><span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
    <span class="err">#</span> <span class="nx">The</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">first</span> <span class="p">(</span><span class="nx">and</span> <span class="nx">only</span><span class="p">)</span> <span class="nx">key</span>
    <span class="mi">4</span> <span class="o">=&gt;</span> <span class="dl">"</span><span class="s2">the_key</span><span class="dl">"</span>
    <span class="err">#</span> <span class="nx">ObjC</span> <span class="nx">classes</span> <span class="nx">are</span> <span class="nx">stored</span> <span class="k">in</span> <span class="k">this</span> <span class="nx">format</span>
    <span class="mi">5</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">$classes</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="mi">0</span> <span class="o">=&gt;</span> <span class="dl">"</span><span class="s2">NSArray</span><span class="dl">"</span>
        <span class="mi">1</span> <span class="o">=&gt;</span> <span class="dl">"</span><span class="s2">NSObject</span><span class="dl">"</span>
      <span class="p">]</span>
      <span class="dl">"</span><span class="s2">$classname</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="dl">"</span><span class="s2">NSArray</span><span class="dl">"</span>
    <span class="p">}</span>
    <span class="mi">6</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">$classes</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="mi">0</span> <span class="o">=&gt;</span> <span class="dl">"</span><span class="s2">NSSharedKeySet</span><span class="dl">"</span>
        <span class="mi">1</span> <span class="o">=&gt;</span> <span class="dl">"</span><span class="s2">NSObject</span><span class="dl">"</span>
      <span class="p">]</span>
      <span class="dl">"</span><span class="s2">$classname</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="dl">"</span><span class="s2">NSSharedKeySet</span><span class="dl">"</span>
    <span class="p">}</span>
    <span class="mi">7</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">$classes</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="mi">0</span> <span class="o">=&gt;</span> <span class="dl">"</span><span class="s2">NSSharedKeyDictionary</span><span class="dl">"</span>
        <span class="mi">1</span> <span class="o">=&gt;</span> <span class="dl">"</span><span class="s2">NSMutableDictionary</span><span class="dl">"</span>
        <span class="mi">2</span> <span class="o">=&gt;</span> <span class="dl">"</span><span class="s2">NSDictionary</span><span class="dl">"</span>
        <span class="mi">3</span> <span class="o">=&gt;</span> <span class="dl">"</span><span class="s2">NSObject</span><span class="dl">"</span>
      <span class="p">]</span>
      <span class="dl">"</span><span class="s2">$classname</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="dl">"</span><span class="s2">NSSharedKeyDictionary</span><span class="dl">"</span>
    <span class="p">}</span>
  <span class="p">]</span>
  <span class="err">#</span> <span class="nx">A</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">root</span> <span class="nx">object</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">archive</span>
  <span class="dl">"</span><span class="s2">$top</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">root</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">CFKeyedArchiverUID</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">}</span>
  <span class="p">}</span>
  <span class="dl">"</span><span class="s2">$version</span><span class="dl">"</span> <span class="o">=&gt;</span> <span class="mi">100000</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Äiá»u Ä‘Ã¡ng chÃº Ã½ á»Ÿ Ä‘Ã¢y lÃ  kiá»ƒu format nÃ y há»— trá»£ tham chiáº¿u Ä‘áº¿n cÃ¡c object bÃªn trong list báº±ng cÃ¡c UID tá»« CFKeyedArchiverUID.</p>

<p>Trong khi Ä‘ang unarchive, NSKeyedUnarchiver sáº½ liÃªn tá»¥c map láº¡i cÃ¡c UID cho nhá»¯ng object Ä‘Ã³. HÆ¡n ná»¯a, viá»‡c tham chiáº¿u Ä‘Æ°á»£c NSKeyedUnarchiver map láº¡i trÆ°á»›c khi phÆ°Æ¡ng thá»©c initWithCoder Ä‘Æ°á»£c thá»±c thi. VÃ¬ váº­y nÃªn ta cÃ³ thá»ƒ decode láº§n lÆ°á»£t cÃ¡c Ä‘á»‘i tÆ°á»£ng Ä‘ang Ä‘Æ°á»£c unarchive ngay trong callstack.</p>

<p>Tá»« Ä‘Ã³ ta biáº¿t Ä‘Æ°á»£c ráº±ng object Ä‘áº§u tiÃªn cÃ³ thá»ƒ <em>chÆ°a Ä‘Æ°á»£c khá»Ÿi táº¡o hoÃ n toÃ n</em> khi nÃ³ Ä‘Æ°á»£c tham chiáº¿u dáº«n Ä‘áº¿n sá»± tá»“n táº¡i lá»— há»•ng CVE-2019-8641.</p>

<p>Pseudo-code (Object-C) cá»§a initWithCoder trong hai class NSSharedKeyDictionary vÃ  NSSharedKeySet nhÆ° sau:</p>

<pre><code class="language-pseudocode">[obj doXWith:y and:z];
obj-&gt;doX(y,z);
</code></pre>

<p>Náº¿u báº¡n khÃ´ng biáº¿t Object-C, cÃ³ thá»ƒ tham kháº£o báº±ng C++:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td> --><td class="rouge-code"><pre><span class="o">-</span><span class="p">[</span><span class="n">NSSharedKeyDictionary</span> <span class="n">initWithCoder</span><span class="o">:</span><span class="n">coder</span><span class="p">]</span> <span class="p">{</span>
  <span class="n">self</span><span class="o">-&gt;</span><span class="n">_keyMap</span> <span class="o">=</span> <span class="p">[</span><span class="n">coder</span> <span class="n">decodeObjectOfClass</span><span class="o">:</span><span class="p">[</span><span class="n">NSSharedKeySet</span> <span class="k">class</span><span class="p">]</span>
                         <span class="nl">forKey:</span><span class="s">"NS.skkeyset"</span><span class="p">];</span>
  <span class="c1">// ... decode values etc.</span>
<span class="p">}</span>

<span class="o">-</span><span class="p">[</span><span class="n">NSSharedKeySet</span> <span class="n">initWithCoder</span><span class="o">:</span><span class="n">coder</span><span class="p">]</span> <span class="p">{</span>
  <span class="n">self</span><span class="o">-&gt;</span><span class="n">_numKey</span> <span class="o">=</span> <span class="p">[</span><span class="n">coder</span> <span class="n">decodeInt64ForKey</span><span class="o">:</span><span class="err">@</span><span class="s">"NS.numKey"</span><span class="p">];</span>
  <span class="n">self</span><span class="o">-&gt;</span><span class="n">_rankTable</span> <span class="o">=</span> <span class="p">[</span><span class="n">coder</span> <span class="n">decodeBytesForKey</span><span class="o">:</span><span class="err">@</span><span class="s">"NS.rankTable"</span><span class="p">];</span>
  <span class="c1">// ... copy more fields from the archive</span>
  <span class="n">self</span><span class="o">-&gt;</span><span class="n">_subSharedKeySet</span> <span class="o">=</span> <span class="p">[</span><span class="n">coder</span> 
                            <span class="nl">decodeObjectOfClass:</span><span class="p">[</span><span class="n">NSSharedKeySet</span> <span class="k">class</span><span class="p">]</span>
                            <span class="nl">forKey:</span><span class="err">@</span><span class="s">"NS.subskset"</span><span class="p">]];</span>

  <span class="n">NSArray</span><span class="o">*</span> <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">coder</span> <span class="n">decodeObjectOfClasses</span><span class="o">:</span><span class="p">[...]</span> 
                         <span class="nl">forKey:</span><span class="err">@</span><span class="s">"NS.keys"</span><span class="p">]];</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="o">-&gt;</span><span class="n">_numKey</span> <span class="o">!=</span> <span class="p">[</span><span class="n">keys</span> <span class="n">count</span><span class="p">])</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">fail</span><span class="p">(</span><span class="err">â€œ</span><span class="n">Inconsistent</span> <span class="n">archive</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">self</span><span class="o">-&gt;</span><span class="n">_keys</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="n">self</span><span class="o">-&gt;</span><span class="n">_numKey</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
  <span class="c1">// copy keys into _keys</span>

  <span class="c1">// Verify that all keys can be looked up</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">id</span> <span class="n">key</span> <span class="n">in</span> <span class="n">keys</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">([</span><span class="n">self</span> <span class="n">indexForKey</span><span class="o">:</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">NSMutableArray</span><span class="o">*</span> <span class="n">allKeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableArray</span> <span class="n">arrayWithArray</span><span class="o">:</span><span class="n">keys</span><span class="p">];</span>
      <span class="p">[</span><span class="n">allKeys</span> <span class="n">addObjectsFromArray</span><span class="o">:</span><span class="p">[</span><span class="n">self</span><span class="o">-&gt;</span><span class="n">_subSharedKeySet</span> <span class="n">allKeys</span><span class="p">]];</span>
      <span class="k">return</span> <span class="p">[</span><span class="n">NSSharedKeySet</span> <span class="n">keySetWithKeys</span><span class="o">:</span><span class="n">allKeys</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>á» dÃ²ng 20, <em>indexForKey</em> trong vÃ²ng láº·p for Ä‘Ã£ sá»­ dá»¥ng hash cá»§a má»™t key Ä‘á»ƒ index vÃ o <em>_rankTable</em> vÃ  sá»­ dá»¥ng káº¿t quáº£ nhÆ° má»™t index vÃ o <em>_keys</em>. NÃ³ tÃ¬m táº¥t cáº£ cÃ¡c key trong subSharedKeySet cho Ä‘áº¿n khi tÃ¬m ra key Ä‘Ãºng:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td> --><td class="rouge-code"><pre><span class="o">-</span><span class="p">[</span><span class="n">NSSharedKeySet</span> <span class="n">indexForKey</span><span class="o">:</span><span class="p">]</span> <span class="p">{</span>
  <span class="n">NSSharedKeySet</span><span class="o">*</span> <span class="n">current</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">prevLength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">current</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Compute a hash from the key and other internal values of    </span>
    <span class="c1">// the KeySet. Convert the hash to an index and ensure that it </span>
    <span class="c1">// is within the bounds of rankTable</span>
    <span class="kt">uint32_t</span> <span class="n">rankTableIndex</span> <span class="o">=</span> <span class="p">...;</span>
    <span class="kt">uint32_t</span> <span class="n">index</span> <span class="o">=</span> <span class="n">self</span><span class="o">-&gt;</span><span class="n">_rankTable</span><span class="p">[</span><span class="n">rankTableIndex</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">self</span><span class="o">-&gt;</span><span class="n">_numKey</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">id</span> <span class="n">candidate</span> <span class="o">=</span> <span class="n">self</span><span class="o">-&gt;</span><span class="n">_keys</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">candidate</span> <span class="o">!=</span> <span class="n">nil</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">([</span><span class="n">key</span> <span class="n">isEqual</span><span class="o">:</span><span class="n">candidate</span><span class="p">])</span> <span class="p">{</span>
          <span class="k">return</span> <span class="n">prevLength</span> <span class="o">+</span> <span class="n">index</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="n">prevLength</span> <span class="o">+=</span> <span class="n">self</span><span class="o">-&gt;</span><span class="n">_numKey</span><span class="p">;</span>
    <span class="n">current</span> <span class="o">=</span> <span class="n">self</span><span class="o">-&gt;</span><span class="n">_subSharedKeySet</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Vá»›i má»› logic trÃªn, object graph sau Ä‘Ã¢y sáº½ chá»‰ rÃµ hÆ¡n vá» lá»—i trÃ n bá»™ nhá»›:</p>

<p><img src="https://miro.medium.com/max/800/0*sCqKzBg2rcN6FJIp.png" alt="Image for post" style="zoom:80%;" /></p>

<p>ÄÃ¢y lÃ  nhá»¯ng gÃ¬ xáº£y ra trong quÃ¡ trÃ¬nh unarchive:</p>

<ol>
  <li>Sau khi NSSharedKeyDictionary Ä‘Æ°á»£c unarchive, nÃ³ sáº½ tá»± unarchive SharedKeySet cá»§a nÃ³.</li>
  <li>PhÆ°Æ¡ng thá»©c <code class="language-plaintext highlighter-rouge">initWithCoder</code> cá»§a ShareKeySet1 Ä‘Æ°á»£c gá»i khi subSharedKeySet cá»§a keyset nÃ y Ä‘Æ°á»£c unarchive. Táº¡i thá»i Ä‘iá»ƒm nÃ y:
+ <code class="language-plaintext highlighter-rouge">_numKeys</code> hoÃ n toÃ n náº±m trong táº§m kiá»ƒm soÃ¡t cá»§a ngÆ°á»i táº¥n cÃ´ng mÃ  khÃ´ng cÃ³ sá»± kiá»ƒm tra nÃ o (kiá»ƒm tra chá»‰ xáº£y ra sau khi <em>_keys</em> Ä‘Ã£ Ä‘Æ°á»£c unarchive)
+ <code class="language-plaintext highlighter-rouge">_rankTable</code> cÅ©ng Ä‘Æ°á»£c kiá»ƒm soÃ¡t
+ <code class="language-plaintext highlighter-rouge">_keys</code> váº«n lÃ  má»™t máº£ng rá»—ng (nullptr)</li>
  <li>SharedKeySet2 Ä‘Ã£ Ä‘Æ°á»£c unarchive xong. subSharedKeySet cá»§a nÃ³ hiá»‡n táº¡i Ä‘ang tham chiáº¿u Ä‘áº¿n SharedKeySet1 (keyset nÃ y váº«n chÆ°a unarchive xong). Cuá»‘i cÃ¹ng, nÃ³ sáº½ gá»i indexForKey cho má»i key trong máº£ng _keys (dÃ²ng 20)</li>
  <li>rankTable cá»§a SharedKeySet2 Ä‘á»u cÃ³ giÃ¡ trá»‹ â€˜0â€™ nÃªn chá»‰ cÃ³ key Ä‘áº§u tiÃªn má»›i cÃ³ thá»ƒ tá»± map chÃ­nh nÃ³ (xem dÃ²ng 8 Ä‘áº¿n 15 trong indexForKey). Tá»« key thá»© 2 nÃ³ sáº½ tham chiáº¿u Ä‘áº¿n SharedKeySet1. Táº¡i Ä‘Ã¢y, vÃ¬ _numKey vÃ  _rankTable Ä‘Ã£ Ä‘Æ°á»£c kiá»ƒm soÃ¡t sáº½ dáº«n Ä‘áº¿n viá»‡c code bá»‹ crash.</li>
</ol>

<p>Callstack táº¡i thá»i Ä‘iá»ƒm crash nhÆ° sau:</p>

<p>ÄÃ¢y lÃ  nhá»¯ng gÃ¬ xáº£y ra trong quÃ¡ trÃ¬nh unarchive:</p>

<ol>
  <li>Sau khi NSSharedKeyDictionary Ä‘Æ°á»£c unarchive, nÃ³ sáº½ tá»± unarchive SharedKeySet cá»§a nÃ³.</li>
  <li>PhÆ°Æ¡ng thá»©c <code class="language-plaintext highlighter-rouge">initWithCoder</code> cá»§a ShareKeySet1 Ä‘Æ°á»£c gá»i khi subSharedKeySet cá»§a keyset nÃ y Ä‘Æ°á»£c unarchive. Táº¡i thá»i Ä‘iá»ƒm nÃ y:
+ <code class="language-plaintext highlighter-rouge">_numKeys</code> hoÃ n toÃ n náº±m trong táº§m kiá»ƒm soÃ¡t cá»§a ngÆ°á»i táº¥n cÃ´ng mÃ  khÃ´ng cÃ³ sá»± kiá»ƒm tra nÃ o (kiá»ƒm tra chá»‰ xáº£y ra sau khi <em>_keys</em> Ä‘Ã£ Ä‘Æ°á»£c unarchive)
+ <code class="language-plaintext highlighter-rouge">_rankTable</code> cÅ©ng Ä‘Æ°á»£c kiá»ƒm soÃ¡t
+ <code class="language-plaintext highlighter-rouge">_keys</code> váº«n lÃ  má»™t máº£ng rá»—ng (nullptr)</li>
  <li>SharedKeySet2 Ä‘Ã£ Ä‘Æ°á»£c unarchive xong. subSharedKeySet cá»§a nÃ³ hiá»‡n táº¡i Ä‘ang tham chiáº¿u Ä‘áº¿n SharedKeySet1 (keyset nÃ y váº«n chÆ°a unarchive xong). Cuá»‘i cÃ¹ng, nÃ³ sáº½ gá»i indexForKey cho má»i key trong máº£ng _keys (dÃ²ng 20)</li>
  <li>rankTable cá»§a SharedKeySet2 Ä‘á»u cÃ³ giÃ¡ trá»‹ â€˜0â€™ nÃªn chá»‰ cÃ³ key Ä‘áº§u tiÃªn má»›i cÃ³ thá»ƒ tá»± map chÃ­nh nÃ³ (xem dÃ²ng 8 Ä‘áº¿n 15 trong indexForKey). Tá»« key thá»© 2 nÃ³ sáº½ tham chiáº¿u Ä‘áº¿n SharedKeySet1. Táº¡i Ä‘Ã¢y, vÃ¬ _numKey vÃ  _rankTable Ä‘Ã£ Ä‘Æ°á»£c kiá»ƒm soÃ¡t sáº½ dáº«n Ä‘áº¿n viá»‡c code bá»‹ crash.</li>
</ol>

<p>Callstack táº¡i thá»i Ä‘iá»ƒm crash nhÆ° sau:</p>

<p><img src="https://miro.medium.com/max/800/0*z2e8N5jKrWFq8a3z.png" alt="Image for post" style="zoom:80%;" /></p>

<p>Do Ä‘Ã³, má»™t Ä‘á»‹a chá»‰ báº¥t kÃ¬ (trong trÆ°á»ng há»£p nÃ y lÃ  0x41414140) sáº½ Ä‘Æ°á»£c tham chiáº¿u Ä‘áº¿n vÃ  Ä‘Æ°á»£c sá»­ dá»¥ng nhÆ° má»™t con trá» object (â€œidâ€). ÄÃ¢y chÃ­nh lÃ  Ä‘á»‹a chá»‰ truy cáº­p Ä‘áº¿n bug nhÆ°ng pháº£i thá»a hai Ä‘iá»u kiá»‡n:</p>

<ol>
  <li>Äá»‹a chá»‰ pháº£i chia háº¿t cho 8 (vÃ¬ máº£ng <code class="language-plaintext highlighter-rouge">_keys </code>chá»©a giÃ¡ trá»‹ kiá»ƒu con trá»)</li>
  <li>Äá»‹a chá»‰ pháº£i Ã­t hÆ¡n 32G vÃ¬ index lÃ  má»™t unsigned integer (4-byte)</li>
</ol>

<p>May máº¯n lÃ  trÃªn iOS, háº§u háº¿t (?) nhá»¯ng thá»© â€œÄ‘áº·c biá»‡tâ€ thÆ°á»ng náº±m dÆ°á»›i 0x800000000 (32G) nÃªn ta cÃ³ thá»ƒ truy cáº­p thoáº£i mÃ¡i.</p>

<p>TÃ³m láº¡i, bÃ i viáº¿t nÃ y cho ta tháº¥y ráº±ng má»™t con trá» rá»—ng (null pointer) láº¡i trá»Ÿ thÃ nh má»™t cÃ´ng cá»¥ exploit nguy hiá»ƒm (Ã­t nháº¥t lÃ  trong trÆ°á»ng há»£p nÃ y).</p>

<p>Tuy nhiÃªn táº¡i thá»i Ä‘iá»ƒm nÃ y, váº«n chÆ°a cÃ³ thÃ´ng tin gÃ¬ vá» Ä‘á»‹a chá»‰ cá»§a cÃ¡c tiáº¿n trÃ¬nh bÃªn thiáº¿t bá»‹ cá»§a náº¡n nhÃ¢n cáº£. Ta sáº½ bÃ n vá» váº¥n Ä‘á» nÃ y trong bÃ i viáº¿t tiáº¿p theo.</p>
:ET